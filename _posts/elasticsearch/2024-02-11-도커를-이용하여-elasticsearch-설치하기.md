---
layout: post_with_ad
title: 도커를 이용하여 elasticsearch 설치하기
date: 2024-02-11 15:53:25 +0900
permalink: /elasticsearch/01-도커를-이용하여-elasticsearch-설치하기
categories: elasticsearch
tags: docker elasticsearch
---

> docker compose 를 이용하여 해봤는데 잊어버릴까바 기록하기 위해서 작성한다.

> 공식 페이지 설치 방법 설명대로 했는데 잘안되어서 삽질
>
> > [8.1.2 설치 가이드](https://www.elastic.co/guide/en/elasticsearch/reference/8.12/getting-started.html)

### docker compose yaml 파일 예시

```yaml
version: "3"
services:
  elasticsearch:
    restart: always
    container_name: es01
    ports:
      - 9200:9200
      - 9300:9300
    image: docker.elastic.co/elasticsearch/elasticsearch:8.12.1

  kibana:
    restart: always
    container_name: kibana
    depends_on:
      - elasticsearch
    ports:
      - 5601:5601
    image: docker.elastic.co/kibana/kibana:8.12.1
```

위와 같이 하면 kibana 가 잘 설치된다. 하지만 es 에서 password 같은게 찾기 어렵다.

docker instance 에 접속하여 elastic user의 password 를 변경시킨다.

```sh
elasticsearch-reset-password -u elastic
```

다음과 비슷한 출력을 할것이다.

```sh
This tool will reset the password of the [elastic] user to an autogenerated value.
The password will be printed in the console.
Please confirm that you would like to continue [y/N]y


Password for the [elastic] user successfully reset.
New value: abcabcabc
```

docker instance 에 접속하여 kibana의 `enrollement-token` 를 발급받는다.

```sh
elasticsearch-create-enrollment-token --scope kibana
```

실행하면 `enroll token` 이 발급된다.

kibana 의 docker logs 에서 접속링크를 확인하고 접속한다.

그리고 발급 받은 enroll token를 입력하면 된다.
![Alt text](/images/2024-02-11-1.png)

재대로 입력하면 다음과 같이 프로세스가 실행된다.

![Alt text](/images/2024-02-11-2.png)

elastic 계정과 새로 발급받은 passowrd를 입력하면 된다.

![Alt text](/images/2024-02-11-3.png)
